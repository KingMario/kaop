!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.kaop=t()}(this,function(){"use strict";function e(e){return!e.advice}function t(e,t,n){return function(){function i(){if(o++,n[o]){var e=n[o];if(r.isMethod(e)){if(!c.prevented)try{c.result=e.apply(c.scope,c.args)}catch(e){c.exception=e}}else e.call(void 0,c);r.isAsync(e)||c.commit()}else if(c.exception)throw c.exception}var o=-1,c={args:Array.prototype.slice.call(arguments),scope:this,key:t,method:r.getMethodFromArraySignature(n),target:e,exception:void 0,prevented:void 0,result:void 0,commit:i,prevent:function(){c.prevented=!0},handle:function(){var e=c.exception;return delete c.exception,e},skip:function(){o=n.findIndex(r.isMethod)-1}};return i(),c.result}}function n(e,t,n){function r(){"function"==typeof this.constructor&&this.constructor.apply(this,arguments)}r.super=e,r.signature=t;var o=i.wove(r,t);return r.prototype=Object.assign(Object.create(e.prototype),o),r}var r={isMethod:e,isValidArraySignature:function(t){return t.every(function(e){return"function"==typeof e})&&1===t.filter(e).length},getMethodFromArraySignature:function(t){return t.find(e)},isAsync:function(e){return!!e.toString().match(/[a-zA-Z$_]\.commit/)},createInstance:function(e){return new e}},i={advice:function(e){return e.advice=1,e},aspect:function(e){return function(t){return Object.keys(t).reduce(e,t)}},wove:function(e,n){var i=Object.assign({},n);for(var o in i)i[o]instanceof Array&&r.isValidArraySignature(i[o])&&(i[o]=t(e,o,i[o]));return i},createProxyFn:t};return{createClass:function(e){return n(function(){},e)},extend:function(e,t){return n(e,t)},clear:function(e){for(var t in e.signature)e.signature[t]instanceof Array&&r.isValidArraySignature(e.signature[t])&&(e.prototype[t]=r.getMethodFromArraySignature(e.signature[t]));return e},override:{apply:i.advice(function(e){e.target.super.prototype[e.key].apply(e.scope,e.args)}),implement:i.advice(function(e){e.args.unshift(e.target.super.prototype[e.key].bind(e.scope))})},inject:{args:function(){var e=Array.prototype.slice.call(arguments);return i.advice(function(t){if("constructor"!==t.key)throw new Error("inject only available in constructor");e.forEach(function(e){t.args.push(e())})})},assign:function(e){return i.advice(function(t){for(var n in e){var r=e[n];t.scope[n]=r()}})}},provider:{factory:function(e){return function(){return r.createInstance(e)}},singleton:function(e){var t;return function(){return t||(t=r.createInstance(e)),t}}},reflect:i}});
