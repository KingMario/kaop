!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).kaop={})}(this,function(e){"use strict";function t(e){return!e.advice}var r={isMethod:t,isValidArraySignature:function(e){return e.every(function(e){return"function"==typeof e})&&1===e.filter(t).length},getMethodFromArraySignature:function(e){return e.find(t)},isAsync:function(e){return!!e.toString().match(/[a-zA-Z$_]\.commit/)},createInstance:function(e,t){return t.unshift(null),new(Function.prototype.bind.apply(e,t))}};function n(e,t,n,o){return function(){var i,c,a,u=-1;function s(){var e=Array.prototype.slice.call(arguments);if(p.args.push.apply(p.args,e),n[++u]){var t=n[u];if(r.isMethod(t)){if(!p.prevented)try{if(o){var s=o(p);Object.assign(s,p.scope),p.result=p.scope=s}else p.result=t.apply(p.scope,p.args)}catch(e){p.exception=e}}else t.call(void 0,p);r.isAsync(t)||p.commit()}else{if(p.exception){if(!i)throw p.exception;a(p.exception)}i&&c(p.result)}}"constructor"!==t&&n.some(function(e){return r.isAsync(e)})&&(i=new Promise(function(e,t){c=e,a=t}));var p={args:Array.prototype.slice.call(arguments),scope:this,key:t,method:r.getMethodFromArraySignature(n),target:e,ES6newTarget:new.target,exception:void 0,prevented:void 0,result:void 0,commit:s,prevent:function(){p.prevented=!0},handle:function(){var e=p.exception;return delete p.exception,e},skip:function(){u=n.findIndex(r.isMethod)-1}};return s(),i||p.result}}var o={advice:function(e){return e.advice=1,e},aspect:function(e){return function(t){return Object.keys(t).reduce(e,t)}},wove:function(e,t){var o=Object.assign({},t);for(var i in o)o[i]instanceof Array&&r.isValidArraySignature(o[i])&&(o[i]=n(e,i,o[i]));return o},createProxyFn:n};function i(e,t,r){function n(){"function"==typeof this.constructor&&this.constructor.apply(this,arguments)}n.super=e,n.signature=t;var i=o.wove(n,t);return n.prototype=Object.assign(Object.create(e.prototype),i),n}var c=function(e){return i(function(){},e)},a=function(e,t){return i(e,t)},u=function(e){for(var t in e.signature)e.signature[t]instanceof Array&&r.isValidArraySignature(e.signature[t])&&(e.prototype[t]=r.getMethodFromArraySignature(e.signature[t]));return e},s={apply:o.advice(function(e){e.target.super.prototype[e.key].apply(e.scope,e.args)}),implement:o.advice(function(e){e.args.unshift(e.target.super.prototype[e.key].bind(e.scope))})};var p={args:function(){var e=Array.prototype.slice.call(arguments);return o.advice(function(t){if("constructor"!==t.key)throw new Error("inject only available in constructor");e.forEach(function(e){t.args.push(e())})})},assign:function(e){return o.advice(function(t){for(var r in e){var n=e[r];t.scope[r]=n()}})}};var f,l,d={factory:function(e){return function(){return r.createInstance(e,Array.prototype.slice.call(arguments))}},singleton:function(e){var t;return function(){var n=Array.prototype.slice.call(arguments);return t||(t=r.createInstance(e,n)),t}}},y=(function(e,t){t.__esModule=!0,t.reflect=t.provider=t.inject=t.override=t.clear=t.extend=t.createClass=void 0,t.createClass=c,t.extend=a,t.clear=u,t.override=s,t.inject=p,t.provider=d,t.reflect=o}(f={exports:{}},f.exports),f.exports),v=(l=y)&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l,g=y.reflect,h=y.provider,x=y.inject,m=y.override,A=y.clear,j=y.extend,b=y.createClass;e.clear=A,e.createClass=b,e.default=v,e.extend=j,e.inject=x,e.override=m,e.provider=h,e.reflect=g,Object.defineProperty(e,"__esModule",{value:!0})});
